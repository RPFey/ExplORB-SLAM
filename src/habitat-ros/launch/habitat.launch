<?xml version="1.0"?>
<!-- SPDX-FileCopyrightText: 2020-2021 Smart Robotics Lab, Imperial College London -->
<!-- SPDX-FileCopyrightText: 2020-2021 Sotiris Papatheodorou -->
<!-- SPDX-License-Identifier: CC0-1.0 -->
<launch>
  <!-- Node arguments -->
  <arg name="habitat_config" default="$(find habitat_ros)/config/habitat.yaml"/>

  <!-- Static Transform Publisher -->
  <node pkg="tf" type="static_transform_publisher" name="static_transform_publisher" output="screen" args="0 0 1.5 -1.57 0 -1.57 base_footprint camera_link_optical 100"/>
  <node pkg="tf" type="static_transform_publisher" name="base_footprint_publisher" output="screen" args="0 0 0 0 0 0 base_footprint base_link 100"/>

  <arg name="namespace" value="robot_1"/>

  <!-- Habitat-Sim node -->
  <node pkg="habitat_ros"
      type="habitat_node.py"
      name="habitat"
      clear_params="true"
      output="screen">
    <rosparam command="load" file="$(arg habitat_config)"/>
    <!-- Hide Habitat-Sim logs -->
    <env name="GLOG_minloglevel" value="1"/>
    <env name="MAGNUM_LOG" value="quiet"/>

    <remap from="/habitat/rgb/camera_info" to="$(arg namespace)/rgb/camera_info"/>
    <remap from="/habitat/depth/camera_info" to="$(arg namespace)/depth/camera_info"/>
    <remap from="/habitat/rgb/image_raw" to="$(arg namespace)/rgb/image_raw"/>
    <remap from="/habitat/depth/image_raw" to="$(arg namespace)/depth/image_raw"/>
    <remap from="/odom" to="$(arg namespace)/odom"/>
    <remap from="/cmd_vel" to="$(arg namespace)/cmd_vel"/>
  </node>

  <node pkg="nodelet" type="nodelet" name="nodelet_manager" args="manager" />

  <node pkg="nodelet" type="nodelet" name="nodelet1"
        args="load depth_image_proc/point_cloud_xyzrgb nodelet_manager">
    <remap from="/rgb/camera_info" to="$(arg namespace)/rgb/camera_info"/>
    <remap from="/depth_registered/image_rect" to="$(arg namespace)/depth/image_raw"/>
    <remap from="/rgb/image_rect_color" to="$(arg namespace)/rgb/image_raw"/>
    <remap from="/depth_registered/points" to="$(arg namespace)/depth_registered/points"/>
  </node>

  <!-- Set the ROS log level in rosconsole.conf -->
  <env name="ROSCONSOLE_CONFIG_FILE" value="$(find habitat_ros)/config/rosconsole.conf"/>
</launch>

